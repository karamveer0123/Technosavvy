var Canvas2Image = function () { var t, r, a = (t = document.createElement("canvas"), { canvas: !!(r = t.getContext("2d")), imageData: !!r.getImageData, dataURL: !!t.toDataURL, btoa: !!window.btoa }), n = "image/octet-stream"; function e(t, r, a) { var n = t.width, e = t.height; null == r && (r = n), null == a && (a = e); var o = document.createElement("canvas"), u = o.getContext("2d"); return o.width = r, o.height = a, u.drawImage(t, 0, 0, n, e, 0, 0, r, a), o } function o(t, r, a, n) { return (t = e(t, a, n)).toDataURL(r) } function u(t) { document.location.href = t } function h(t) { var r = document.createElement("img"); return r.src = t, r } function s(t) { return "image/" + (t = t.toLowerCase().replace(/jpg/i, "jpeg")).match(/png|jpeg|bmp|gif/)[0] } function p(t) { if (!window.btoa) throw "btoa undefined"; var r = ""; if ("string" == typeof t) r = t; else for (var a = 0; a < t.length; a++)r += String.fromCharCode(t[a]); return btoa(r) } function i(t) { var r = t.width, a = t.height; return t.getContext("2d").getImageData(0, 0, r, a) } function f(t, r) { return "data:" + r + ";base64," + t } var c = function (t) { var r = [], a = [], n = t.width, e = t.height; r.push(66), r.push(77); var o = n * e * 3 + 54; r.push(o % 256), o = Math.floor(o / 256), r.push(o % 256), o = Math.floor(o / 256), r.push(o % 256), o = Math.floor(o / 256), r.push(o % 256), r.push(0), r.push(0), r.push(0), r.push(0), r.push(54), r.push(0), r.push(0), r.push(0), a.push(40), a.push(0), a.push(0), a.push(0); var u = n; a.push(u % 256), u = Math.floor(u / 256), a.push(u % 256), u = Math.floor(u / 256), a.push(u % 256), u = Math.floor(u / 256), a.push(u % 256); var h = e; a.push(h % 256), h = Math.floor(h / 256), a.push(h % 256), h = Math.floor(h / 256), a.push(h % 256), h = Math.floor(h / 256), a.push(h % 256), a.push(1), a.push(0), a.push(24), a.push(0), a.push(0), a.push(0), a.push(0), a.push(0); var s = n * e * 3; a.push(s % 256), s = Math.floor(s / 256), a.push(s % 256), s = Math.floor(s / 256), a.push(s % 256), s = Math.floor(s / 256), a.push(s % 256); for (var i = 0; i < 16; i++)a.push(0); var f = (4 - 3 * n % 4) % 4, c = t.data, g = "", v = e; do { for (var m = n * (v - 1) * 4, l = "", d = 0; d < n; d++) { var C = 4 * d; l += String.fromCharCode(c[m + C + 2]), l += String.fromCharCode(c[m + C + 1]), l += String.fromCharCode(c[m + C]) } for (var M = 0; M < f; M++)l += String.fromCharCode(0); g += l } while (--v); return p(r.concat(a)) + p(g) }, g = function (t, r, h, p) { if (a.canvas && a.dataURL) if (null == p && (p = "png"), p = s(p), /bmp/.test(p)) { var g = i(e(t, r, h)); u(f(c(g), n)) } else { u(o(t, p, r, h).replace(p, n)) } }, v = function (t, r, n, u) { if (a.canvas && a.dataURL) { if (null == u && (u = "png"), u = s(u), /bmp/.test(u)) { var p = i(e(t, r, n)); return h(f(c(p), "image/bmp")) } return h(o(t, u, r, n)) } }; return { saveAsImage: g, saveAsPNG: function (t, r, a) { return g(t, r, a, "png") }, saveAsJPEG: function (t, r, a) { return g(t, r, a, "jpeg") }, saveAsGIF: function (t, r, a) { return g(t, r, a, "gif") }, saveAsBMP: function (t, r, a) { return g(t, r, a, "bmp") }, convertToImage: v, convertToPNG: function (t, r, a) { return v(t, r, a, "png") }, convertToJPEG: function (t, r, a) { return v(t, r, a, "jpeg") }, convertToGIF: function (t, r, a) { return v(t, r, a, "gif") }, convertToBMP: function (t, r, a) { return v(t, r, a, "bmp") } } }();